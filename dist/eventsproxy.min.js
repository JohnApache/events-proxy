!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.eventsproxy=e()}(this,function(){"use strict";function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function e(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}function n(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var t=function(t){return"[object Object]"===Object.prototype.toString.call(t)},r=function(t){return"string"==typeof t},s=function(t){return"number"==typeof t},u=function(t){return Array.isArray(t)},c=r,a=function(){function t(){o(this,t),this._stack={}}return e(t,[{key:"initStack",value:function(t){c(t)&&(this._stack[t]||(this._stack[t]=[]))}},{key:"initStacks",value:function(t){var e=this;(t=[].concat(t)).forEach(function(t){e.initStack(t)})}},{key:"queryStack",value:function(t){return this.initStack(t),this._stack[t]}},{key:"setStack",value:function(t,e){this._stack[t]=[].concat(e)}},{key:"pushStack",value:function(t,e){return this.initStack(t),this._stack[t].push(e)}},{key:"push",value:function(t,e){return this.pushStack(t,e)}},{key:"pushStacks",value:function(t,e){var n=this;t=[].concat(t),this.initStacks(t),t.forEach(function(t){n.pushStack(t,e)})}},{key:"popStack",value:function(t){return this.initStack(t),this._stack[t].shift()}},{key:"pop",value:function(t){return this.popStack(t)}},{key:"popStacks",value:function(t){var e=this;t=[].concat(t);var n=[];return this.initStacks(t),t.forEach(function(t){n.push(e.popStack(t))}),n}},{key:"checkKey",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1;return e=e<1?1:e,u(this._stack[t])&&this._stack[t].length>=e}},{key:"checkKeys",value:function(t,e){var n=this;return(t=[].concat(t)).every(function(t){return n.checkKey(t,e)})}},{key:"forEachByKey",value:function(n,i){var o=this;this.checkKey(n)&&this._stack[n].forEach(function(t,e){i&&i(t,e,o._stack[n])})}},{key:"clear",value:function(){this._stack={}}}]),t}(),f=function(){return new a},h=",",p="__EVENT__",y="__EVENT__BEFORE__EXECUTE__",_="__EVENT__AFTER_EXECUTE__",l=function(){function t(){o(this,t),this._pp={}}return e(t,[{key:"_initProxy",value:function(t){this._pp[t]||(this._pp[t]=f())}},{key:"_executeBefore",value:function(e,n){this._pp[e].forEachByKey(y,function(t){t&&t.done&&t.done(e,n)})}},{key:"_execute",value:function(e,n){this._pp[e].forEachByKey(p,function(t){t&&t.done&&t.done(e,n)})}},{key:"_executeAfter",value:function(e,n){this._pp[e].forEachByKey(_,function(t){t&&t.done&&t.done(e,n)})}},{key:"_beforeExecute",value:function(t,e){this._initProxy(t),this._pp[t].pushStack(y,e)}},{key:"beforeExecute",value:function(t,e){var n=this;(t=[].concat(t)).forEach(function(t){n._beforeExecute(t,e)})}},{key:"_afterExecute",value:function(t,e){this._initProxy(t),this._pp[t].pushStack(_,e)}},{key:"afterExecute",value:function(t,e){var n=this;(t=[].concat(t)).forEach(function(t){n._afterExecute(t,e)})}},{key:"assignProxy",value:function(t,e){this._initProxy(t),this._pp[t].pushStack(p,e)}},{key:"assignProxys",value:function(t,e){var n=this;(t=[].concat(t)).forEach(function(t){n.assignProxy(t,e)})}},{key:"fireProxy",value:function(t,e){if(e&&t){var n=this._pp[t].queryStack(p);this._pp[t].setStack(p,n.filter(function(t){return!t.isDeepEqualEvent(e)}))}}},{key:"fireProxys",value:function(t,e){var n=this;(t=[].concat(t)).forEach(function(t){n.fireProxy(t,e)})}},{key:"emitProxy",value:function(t,e){this._pp[t]&&(this._executeBefore(t,e),this._execute(t,e),this._executeAfter(t,e))}}]),t}(),v=function(){return new l},k=function(){function i(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1;o(this,i),this._ev=[].concat(t),this._cb=e,this._sp=f(),this._wc=Math.abs(n)}return e(i,[{key:"isDeepEqualEvent",value:function(t){return this._cb===t._cb&&this._ev.join("")===t._ev.join("")&&this._wc===t._wc}},{key:"execute",value:function(){if(this._sp.checkKeys(this._ev,this._wc)){for(var t=[],e=0;e<this._wc;e++)t.push(this._sp.popStacks(this._ev));1===t.length&&(t=t[0]),this._cb&&this._cb.apply(this,n(t))}}},{key:"done",value:function(t,e){t=[].concat(t),this._sp.pushStacks(t,e),this.execute()}}]),i}(),x=function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1;return n=n<1?1:n,new k(t,e,Math.ceil(n))},d=h,b=t,E=r,g=s,S=function(){function t(){o(this,t),this._proxy=v(),this._proxy_loop_split=d}return e(t,[{key:"_addProxys",value:function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1;t=[].concat(t),this._proxy.assignProxys(t,x(t,e,n))}},{key:"_addProxysLoops",value:function(t){for(var e in t)this.register(e.split(this._proxy_loop_split),t[e])}},{key:"_removeProxys",value:function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1;t=[].concat(t),this._proxy.fireProxys(t,x(t,e,n))}},{key:"_removeProxysLoops",value:function(t,e){for(var n in t)this.unregister(n.split(this._proxy_loop_split),t[n],e)}},{key:"_beforeLoops",value:function(t){for(var e in t)this.before(e.split(this._proxy_loop_split),t[e])}},{key:"_afterLoops",value:function(t){for(var e in t)this.after(e.split(this._proxy_loop_split),t[e])}},{key:"_onceLoops",value:function(t){for(var e in t)this.once(e.split(this._proxy_loop_split),t[e])}},{key:"_waitLoops",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1;for(var n in t)this.wait(n.split(this._proxy_loop_split),t[n],e)}},{key:"_bindNTimesLoops",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1;for(var n in t)this.bindNTimes(n.split(this._proxy_loop_split),t[n],e)}},{key:"setProxyLoopSplit",value:function(t){this._proxy_loop_split=t}},{key:"before",value:function(t,e){if(b(t))return this._beforeLoops(t);t=[].concat(t),this._proxy.beforeExecute(t,x(t,e))}},{key:"after",value:function(t,e){if(b(t))return this._afterLoops(t);t=[].concat(t),this._proxy.afterExecute(t,x(t,e))}},{key:"register",value:function(t,e){return b(t)?this._addProxysLoops(t):(this._addProxys(t,e),this.unregister.bind(this,t,e))}},{key:"subscribe",value:function(t,e){return this.register(t,e)}},{key:"bind",value:function(t,e){return this.register(t,e)}},{key:"on",value:function(t,e){return this.register(t,e)}},{key:"once",value:function(t,e){if(b(t))return this._onceLoops(t);var n=this.register(t,function(){e&&e.apply(void 0,arguments),n&&n()});return n}},{key:"bindNTimes",value:function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1;if(b(t))return g(e)?this._bindNTimesLoops(t,e):this._bindNTimesLoops(t,n);n=n<1?1:n;var i=this.register(t,function(){e&&e.apply(void 0,arguments),0===--n&&i&&i()});return i}},{key:"wait",value:function(t,e,n){return b(t)?g(e)?this._waitLoops(t,e):this._waitLoops(t,n):(this._addProxys(t,e,n),this.unregister.bind(this,t,e,n))}},{key:"unregister",value:function(t,e,n){if(b(t))return this._removeProxysLoops(t,n);this._removeProxys(t,e,n)}},{key:"unsubscribe",value:function(t,e){this.unregister(t,e)}},{key:"unbind",value:function(t,e){this.unregister(t,e)}},{key:"off",value:function(t,e){this.unregister(t,e)}},{key:"emit",value:function(t,e){E(t)&&this._proxy.emitProxy(t,e)}},{key:"done",value:function(t,e){this.emit(t,e)}},{key:"async",value:function(t){var i,e=new Promise(function(t){i=t});return this.once(t,function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];i(e)}),e}}]),t}();return function(t,e){var n=new S;return t&&e&&n.register(t,e),n}});
