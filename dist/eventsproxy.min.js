!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.eventsproxy=e()}(this,function(){"use strict";function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function e(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}function i(t){return function(t){if(Array.isArray(t)){for(var e=0,i=new Array(t.length);e<t.length;e++)i[e]=t[e];return i}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var t=function(t){return"[object Object]"===Object.prototype.toString.call(t)},r=function(t){return"string"==typeof t},s=function(t){return"number"==typeof t},u=function(t){return Array.isArray(t)},c=r,a=function(){function t(){o(this,t),this._stack={}}return e(t,[{key:"initStack",value:function(t){c(t)&&(this._stack[t]||(this._stack[t]=[]))}},{key:"initStacks",value:function(t){var e=this;(t=[].concat(t)).forEach(function(t){e.initStack(t)})}},{key:"queryStack",value:function(t){return this.initStack(t),this._stack[t]}},{key:"setStack",value:function(t,e){this._stack[t]=[].concat(e)}},{key:"pushStack",value:function(t,e){return this.initStack(t),this._stack[t].push(e)}},{key:"push",value:function(t,e){return this.pushStack(t,e)}},{key:"pushStacks",value:function(t,e){var i=this;t=[].concat(t),this.initStacks(t),t.forEach(function(t){i.pushStack(t,e)})}},{key:"popStack",value:function(t){return this.initStack(t),this._stack[t].shift()}},{key:"pop",value:function(t){return this.popStack(t)}},{key:"popStacks",value:function(t){var e=this;t=[].concat(t);var i=[];return this.initStacks(t),t.forEach(function(t){i.push(e.popStack(t))}),i}},{key:"checkKey",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1;return e=e<1?1:e,u(this._stack[t])&&this._stack[t].length>=e}},{key:"checkKeys",value:function(t,e){var i=this;return(t=[].concat(t)).every(function(t){return i.checkKey(t,e)})}},{key:"forEachByKey",value:function(i,n){var o=this;this.checkKey(i)&&this._stack[i].forEach(function(t,e){n&&n(t,e,o._stack[i])})}},{key:"clear",value:function(){this._stack={}}}]),t}(),f=function(){return new a},h=",",p="__EVENT__",y="__EVENT__BEFORE__EXECUTE__",_="__EVENT__AFTER_EXECUTE__",l=function(){function t(){o(this,t),this._pp={}}return e(t,[{key:"_initProxy",value:function(t){this._pp[t]||(this._pp[t]=f())}},{key:"_executeBefore",value:function(e,i){this._pp[e].forEachByKey(y,function(t){t&&t.done&&t.done(e,i)})}},{key:"_execute",value:function(e,i){this._pp[e].forEachByKey(p,function(t){t&&t.done&&t.done(e,i)})}},{key:"_executeAfter",value:function(e,i){this._pp[e].forEachByKey(_,function(t){t&&t.done&&t.done(e,i)})}},{key:"_beforeExecute",value:function(t,e){this._initProxy(t),this._pp[t].pushStack(y,e)}},{key:"beforeExecute",value:function(t,e){var i=this;(t=[].concat(t)).forEach(function(t){i._beforeExecute(t,e)})}},{key:"_afterExecute",value:function(t,e){this._initProxy(t),this._pp[t].pushStack(_,e)}},{key:"afterExecute",value:function(t,e){var i=this;(t=[].concat(t)).forEach(function(t){i._afterExecute(t,e)})}},{key:"assignProxy",value:function(t,e){this._initProxy(t),this._pp[t].pushStack(p,e)}},{key:"assignProxys",value:function(t,e){var i=this;(t=[].concat(t)).forEach(function(t){i.assignProxy(t,e)})}},{key:"fireProxy",value:function(t,e){if(e&&t){var i=this._pp[t].queryStack(p);this._pp[t].setStack(p,i.filter(function(t){return!t.isDeepEqualEvent(e)}))}}},{key:"fireProxys",value:function(t,e){var i=this;(t=[].concat(t)).forEach(function(t){i.fireProxy(t,e)})}},{key:"emitProxy",value:function(t,e){this._pp[t]&&(this._executeBefore(t,e),this._execute(t,e),this._executeAfter(t,e))}}]),t}(),v=function(){return new l},k=function(){function n(t,e){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1;o(this,n),this._ev=[].concat(t),this._cb=e,this._sp=f(),this._wc=Math.abs(i)}return e(n,[{key:"isDeepEqualEvent",value:function(t){return this._cb===t._cb&&this._ev.join("")===t._ev.join("")&&this._wc===t._wc}},{key:"execute",value:function(){if(this._sp.checkKeys(this._ev,this._wc)){for(var t=[],e=0;e<this._wc;e++)t.push(this._sp.popStacks(this._ev));1===t.length&&(t=t[0]),this._cb&&this._cb.apply(this,i(t))}}},{key:"done",value:function(t,e){t=[].concat(t),this._sp.pushStacks(t,e),this.execute()}}]),n}(),x=function(t,e){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1;return i=i<1?1:i,new k(t,e,Math.ceil(i))},d=h,b=t,E=r,g=s,S=function(){function t(){o(this,t),this._proxy=v(),this._proxy_loop_split=d}return e(t,[{key:"_addProxys",value:function(t,e){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1;t=[].concat(t),this._proxy.assignProxys(t,x(t,e,i))}},{key:"_addProxysLoops",value:function(t){for(var e in t)this.register(e.split(this._proxy_loop_split),t[e])}},{key:"_removeProxys",value:function(t,e){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1;t=[].concat(t),this._proxy.fireProxys(t,x(t,e,i))}},{key:"_removeProxysLoops",value:function(t,e){for(var i in t)this.unregister(i.split(this._proxy_loop_split),t[i],e)}},{key:"_beforeLoops",value:function(t){for(var e in t)this.before(e.split(this._proxy_loop_split),t[e])}},{key:"_afterLoops",value:function(t){for(var e in t)this.after(e.split(this._proxy_loop_split),t[e])}},{key:"_onceLoops",value:function(t){for(var e in t)this.once(e.split(this._proxy_loop_split),t[e])}},{key:"_waitLoops",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1;for(var i in t)this.wait(i.split(this._proxy_loop_split),t[i],e)}},{key:"_bindNTimesLoops",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1;for(var i in t)this.bindNTimes(i.split(this._proxy_loop_split),t[i],e)}},{key:"setProxyLoopSplit",value:function(t){this._proxy_loop_split=t}},{key:"before",value:function(t,e){if(b(t))return this._beforeLoops(t);t=[].concat(t),this._proxy.beforeExecute(t,x(t,e))}},{key:"after",value:function(t,e){if(b(t))return this._afterLoops(t);t=[].concat(t),this._proxy.afterExecute(t,x(t,e))}},{key:"register",value:function(t,e){return b(t)?this._addProxysLoops(t):(this._addProxys(t,e),this.unregister.bind(this,t,e))}},{key:"subscribe",value:function(t,e){return this.register(t,e)}},{key:"bind",value:function(t,e){return this.register(t,e)}},{key:"on",value:function(t,e){return this.register(t,e)}},{key:"once",value:function(t,e){if(b(t))return this._onceLoops(t);var i=this.register(t,function(){e&&e.apply(void 0,arguments),i&&i()});return i}},{key:"bindNTimes",value:function(t,e){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1;if(b(t))return g(e)?this._bindNTimesLoops(t,e):this._bindNTimesLoops(t,i);i=i<1?1:i;var n=this.register(t,function(){e&&e.apply(void 0,arguments),0===--i&&n&&n()});return n}},{key:"wait",value:function(t,e,i){return b(t)?g(e)?this._waitLoops(t,e):this._waitLoops(t,i):(this._addProxys(t,e,i),this.unregister.bind(this,t,e,i))}},{key:"unregister",value:function(t,e,i){if(b(t))return this._removeProxysLoops(t,i);this._removeProxys(t,e,i)}},{key:"unsubscribe",value:function(t,e){this.unregister(t,e)}},{key:"unbind",value:function(t,e){this.unregister(t,e)}},{key:"off",value:function(t,e){this.unregister(t,e)}},{key:"emit",value:function(t,e){E(t)&&this._proxy.emitProxy(t,e)}},{key:"done",value:function(t,e){this.emit(t,e)}}]),t}();return function(t,e){var i=new S;return t&&e&&i.register(t,e),i}});
